(function(n){n.fn.SessionTimeout=function(t){var i=this,f;if(i.Debug=function(n){t.debug&&console.log("APIKings-st DEBUG: "+n)},i.Debug("Initializing API"),f={stayButtonText:"Stay logged in",leaveButtonText:"Log out",title:"Session timeout",message:"You have been inactive for {timeout}. You will be logged out in {timeleft}.",timeout:300,showWarningBoxFor:30,debug:!1,logoutFormId:"",logoutUrl:"",enableProgressBar:!1,method:"POST"},t=n.extend(f,t),t.method=t.method.toUpperCase(),t.message=t.message.replace("{timeleft}","<span id='APIKings-st-timeleft'><\/span>"),t.message=t.message.replace("{timeout}","<span id='APIKings-st-timeout'><\/span>"),n("#APIKings-st-timeout").each(function(){n(this).html(i.GetFormatedTime(t.timeout))}),t.method!="POST"&&t.method!="GET"){console.log("APIKings-ST  WARNING: Unrecognised method: "+t.method);console.log("Accepted methods: GET or POST");return}if(t.method=="POST"&&t.logoutFormId==""){console.log("APIKings-ST  WARNING: You need to provide your logout form id for SessionTimeout to work!");return}if(t.method=="GET"&&t.logoutUrl==""){console.log("APIKings-ST  WARNING: You need to provide your logout url for SessionTimeout to work!");return}var r=0,u,e="<div class='APIKings-st-modal-container' id='APIKings-st-modal'><div class='APIKings-st-modal'><div class='heading'>"+t.title+"<\/div><div class='body'>"+t.message+"<\/div><div class='footer'><button class='stay' id='APIKings-st-stay-button'>"+t.stayButtonText+"<\/button><button class='leave' id='APIKings-st-leave-button'>"+t.leaveButtonText+"<\/button><\/div><\/div><\/div>";i.before("<div class='APIKings-st-overlay' id='APIKings-st-overlay'><\/div>");i.html(e);t.enableProgressBar&&i.after("<div id='APIKings-st-progress-bar-container'><div id='APIKings-st-progress-bar'><\/div><\/div>");i.StartSessionTimer=function(){var f,e;if(i.Debug("Tick called"),r++,i.Debug("Ticks: "+r++),f=t.timeout+t.showWarningBoxFor-r,n("#APIKings-st-timeleft").each(function(){n(this).html(i.GetFormatedTime(f))}),n("#APIKings-st-timeout").each(function(){n(this).html(i.GetFormatedTime(t.timeout))}),t.enableProgressBar&&(e=100-r/t.timeout*100,n("#APIKings-st-progress-bar").css("width",e+"%")),r===t.timeout&&i.ShowModal(),r===t.timeout+t.showWarningBoxFor){clearTimeout(u);i.Logout();return}u=setTimeout(i.StartSessionTimer,1e3)};i.GetFormatedTime=function(n){var r=parseInt(n,10),u=Math.floor(r/3600),t=Math.floor((r-u*3600)/60),n=r-u*3600-t*60,i="";return t>0&&(i+=t>1?t+" minutes":t+" minute"),n>0&&(t>0&&(i+=" "),i+=n>1?n+" seconds":n+" second"),i};n("#APIKings-st-stay-button").click(function(){i.Debug("Stay button clicked");i.HideModal();r=0});n("#APIKings-st-leave-button").click(function(){i.Debug("Leave clicked");i.HideModal();i.Logout()});this.Logout=function(){t.method=="POST"&&document.getElementById(t.logoutFormId).submit();t.method=="GET"&&(window.location.href=t.logoutUrl)};this.ShowModal=function(){i.Debug("ShowModal called");n("#APIKings-st-modal").show();n("#APIKings-st-overlay").fadeIn()};this.HideModal=function(){i.Debug("HideModal called");n("#APIKings-st-modal").hide();n("#APIKings-st-overlay").fadeOut()};n("body").on("click keypress",function(){r=0;i.Debug("click or keypress detected")});return document.addEventListener("scroll",function(){r=0;i.Debug("scroll detected")},!0),u=setTimeout(i.StartSessionTimer(),1e3),t.method=="POST"&&i.Debug("Logout method: "+t.method+" form id: "+t.logoutFormId),t.method=="GET"&&i.Debug("Logout method: "+t.method+" url: "+t.logoutUrl),i.Debug("Finished initializing API"),this}})(jQuery);